# https://keda.sh/docs/2.17/reference/scaledobject-spec/
apiVersion: v1
kind: Secret
metadata:
  name: mysql-secrets
  namespace: scaling
type: Opaque
data:
  mysql_conn_str: ZGVtbzpkZW1vQHRjcChteXNxbC5zY2FsaW5nLnN2Yy5jbHVzdGVyLmxvY2FsOjMzMDYpL2tlZGFfcGhw
  # mysql_conn_str: "demo:demo@tcp(mysql.scaling.svc.cluster.local:3306)/keda_php" # base64 encoded
---
apiVersion: keda.sh/v1alpha1
kind: TriggerAuthentication
metadata:
  name: keda-trigger-auth-mysql-secret
  namespace: scaling
spec:
  secretTargetRef:
  - parameter: connectionString
    name: mysql-secrets
    key: mysql_conn_str  
---  
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: php-mysql-scaler
  namespace: scaling
spec:
  scaleTargetRef:
    name: php-app
    kind: Deployment
  pollingInterval: 20   # This is the interval to check each trigger on. By default, KEDA will check each trigger source on every ScaledObject every 30 seconds.
  cooldownPeriod: 15    # The period to wait after the last trigger reported active before scaling the resource back to 0, in seconds. By default, itâ€™s 300 (5 minutes).
  minReplicaCount: 1
  maxReplicaCount: 5    
  triggers:
  - type: mysql
    metadata:
      queryValue: "10"
      activationQueryValue: "10"
      query: "SELECT count FROM request_counter WHERE id=1"
    authenticationRef:
      name: keda-trigger-auth-mysql-secret